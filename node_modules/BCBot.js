var builder = require('botbuilder');

function throwIncorrectFactoryError() {
	throw new Error("Incorrect factory type found.");
}

function Extendable() {}
Extendable.prototype.extend = function(func, code) {
	this[func] = code;
};


var BCBot = function(model) {
	Extendable.call(this);
	this.model = model;
	this.dialog = new builder.LuisDialog(model);
	this.bot = new builder.TextBot();
}
BCBot.prototype = new Extendable();
BCBot.prototype.constructor = BCBot;
BCBot.prototype.addCommand = function(factory) {
	if (factory.getType() == "BotCommandFactory") {
		this.dialog.on(factory.getIntent(), factory.getAction());
	} else {
		throwIncorrectFactoryError();
	}
};
BCBot.prototype.attach = function(url) {
	this.bot.add(url, this.dialog);
};
BCBot.prototype.setDefault = function(factory) {
	if (factory.getType() == "BotDefaultCommandFactory") {
		this.dialog.onDefault(factory.getAction());
	} else {
		throwIncorrectFactoryError();
	}
};
BCBot.prototype.listenStdin = function() {
	this.bot.listenStdin();
}

var BotCommandFactory = function(intent, action) {
	this.getIntent = function() {
		return intent;
	};
	this.getAction = function() {
		return action;
	};
	this.getType = function() {
		return "BotCommandFactory";
	};
};

var BotDefaultCommandFactory = function(action) {
	this.getAction = function() {
		return action;
	};
	this.getType = function() {
		return "BotDefaultCommandFactory";
	};
};

console.log((new BotCommandFactory("1", "2")).getIntent());


// test bot
var cortanaModel = 'https://api.projectoxford.ai/luis/v1/application?id=c413b2ef-382c-45bd-8ff0-f76d60e2a821&subscription-key=ec8bb8f3d3d74a898c1cd1ddd7e0c8c8&q=';
var model2 = 'https://api.projectoxford.ai/luis/v1/application?id=f86def56-4901-4874-89c1-19f43e9e7d9d&subscription-key=9b8a3f03610f4c5aa8f07e1b31664d27&q=';

var testBot = new BCBot(model2);
testBot.addCommand(new BotCommandFactory('mkdir', builder.DialogAction.send('mkdir')));

// var testBot = new BCBot(cortanaModel);
// testBot.addCommand(new BotCommandFactory('builtin.intent.alarm.set_alarm', builder.DialogAction.send('Creating Alarm')));
// testBot.addCommand(new BotCommandFactory('builtin.intent.alarm.delete_alarm', builder.DialogAction.send('Deleting Alarm')));

testBot.setDefault(new BotDefaultCommandFactory(builder.DialogAction.send("I'm sorry I didn't understand. I can only create & delete alarms.")));
testBot.listenStdin();
testBot.attach('/');

// bot.add('/', function (session) {
  // session.send('Hello World');
// });

// module.exports = bot;
// module.exports = cortanaBot;
