var builder = require('botbuilder');
var utils = require('../util.js');

var BCBot = function(model, type) {
	utils.Extendable.call(this);
	this.model = model;
	this.dialog = new builder.LuisDialog(model);
  if (["BotConnectorBot", "TextBot"].indexOf(type) != -1)
	 this.bot = new builder[type]();
  else
    utils.throwIncorrectBotTypeError();
}
BCBot.prototype = new utils.Extendable();
BCBot.prototype.constructor = BCBot;
BCBot.prototype.addCommand = function(factory) {
	if (factory.getType() == "BotCommandFactory") {
		this.dialog.on(factory.getIntent(), factory.getAction());
	} else {
		utils.throwIncorrectFactoryError();
	}
};
BCBot.prototype.attach = function(url) {
	this.bot.add(url, this.dialog);
};
BCBot.prototype.setDefault = function(factory) {
	if (factory.getType() == "BotDefaultCommandFactory") {
		this.dialog.onDefault(factory.getAction());
	} else {
		utils.throwIncorrectFactoryError();
	}
};
BCBot.prototype.listenStdin = function() {
	this.bot.listenStdin();
}
module.exports = BCBot;
