var builder = require('botbuilder');
var utils = require('../util.js');

var BCBot = function(model) {
	utils.Extendable.call(this);
	this.model = model;
	this.dialog = new builder.LuisDialog(model);
	this.bot = new builder.TextBot();
}
BCBot.prototype = new utils.Extendable();
BCBot.prototype.constructor = BCBot;
BCBot.prototype.addCommand = function(factory) {
	if (factory.getType() == "BotCommandFactory") {
		this.dialog.on(factory.getIntent(), factory.getAction());
	} else {
		utils.throwIncorrectFactoryError();
	}
};
BCBot.prototype.attach = function(url) {
	this.bot.add(url, this.dialog);
};
BCBot.prototype.setDefault = function(factory) {
	if (factory.getType() == "BotDefaultCommandFactory") {
		this.dialog.onDefault(factory.getAction());
	} else {
		utils.throwIncorrectFactoryError();
	}
};
BCBot.prototype.listenStdin = function() {
	this.bot.listenStdin();
}


console.log((new utils.BotCommandFactory("1", "2")).getIntent());


// test bot
var cortanaModel = 'https://api.projectoxford.ai/luis/v1/application?id=c413b2ef-382c-45bd-8ff0-f76d60e2a821&subscription-key=ec8bb8f3d3d74a898c1cd1ddd7e0c8c8&q=';
var model2 = 'https://api.projectoxford.ai/luis/v1/application?id=f86def56-4901-4874-89c1-19f43e9e7d9d&subscription-key=9b8a3f03610f4c5aa8f07e1b31664d27&q=';

var testBot = new BCBot(model2);
testBot.addCommand(new utils.BotCommandFactory('mkdir', builder.DialogAction.send('mkdir')));

// var testBot = new BCBot(cortanaModel);
// testBot.addCommand(new BotCommandFactory('builtin.intent.alarm.set_alarm', builder.DialogAction.send('Creating Alarm')));
// testBot.addCommand(new BotCommandFactory('builtin.intent.alarm.delete_alarm', builder.DialogAction.send('Deleting Alarm')));

testBot.setDefault(new utils.BotDefaultCommandFactory(builder.DialogAction.send("I'm sorry I didn't understand. I can only create & delete alarms.")));
testBot.listenStdin();
testBot.attach('/');

// bot.add('/', function (session) {
  // session.send('Hello World');
// });

// module.exports = bot;
// module.exports = cortanaBot;
